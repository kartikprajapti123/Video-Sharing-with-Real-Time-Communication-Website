# Listen on HTTP (port 81) and HTTPS (port 444)
Listen 81
Listen 444

# Global ServerName
ServerName shareyourclips.online

# Include generic snippets of statements
IncludeOptional conf-enabled/*.conf

# Include the virtual host configurations:
IncludeOptional sites-enabled/*.conf

# HTTP to HTTPS Redirect (Port 81)
<VirtualHost *:81>
    ServerName shareyourclips.online
    ServerAlias www.shareyourclips.online
    ServerAdmin kartikprajapati26122004@gmail.com

    # Redirect HTTP to HTTPS
    Redirect permanent / https://shareyourclips.online:444/

    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

# HTTPS Configuration (Port 444)
<VirtualHost *:444>
    ServerName shareyourclips.online
    ServerAlias www.shareyourclips.online

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/fullchain.pem
    SSLCertificateKeyFile /etc/ssl/private/privkey.pem

    DocumentRoot /app

    # WSGI Configuration for Django
    WSGIDaemonProcess Jerry-Project python-path=/app python-home=/app/.venv
    WSGIProcessGroup Jerry-Project
    WSGIScriptAlias / /app/Jerry-Project/wsgi.py

    <Directory /app>
        Require all granted
    </Directory>

    # Alias for static and media files
    Alias /static /var/www/Jerry-Project/static
    <Directory /var/www/Jerry-Project/static>
        Require all granted
    </Directory>

    Alias /media /var/www/Jerry-Project/media
    <Directory /var/www/Jerry-Project/media>
        Require all granted
    </Directory>

    # WebSocket proxy settings
    RewriteEngine on
    RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC,OR]
    RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
    RewriteRule .* wss://shareyourclips.online:8001%{REQUEST_URI} [P,QSA,L]

    ProxyPass /wss/ wss://shareyourclips.online:8001/
    ProxyPassReverse /wss/ wss://shareyourclips.online:8001/
</VirtualHost>
